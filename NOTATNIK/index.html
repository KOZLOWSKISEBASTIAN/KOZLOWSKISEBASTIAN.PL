<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOTATNIK</title>
    <meta name="theme-color" content="#000000">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://kozlowskisebastian.pl/CSS/PRZYBORNIK.css">
    <style>
/* NOTATNIK POCZĄTEK */
.KOZLOWSKISEBASTIAN .notatnik-kontener {
    max-width: 520px;
    width: 100%;
    background: #333333;
    padding: 8px;
    border-radius: 8px;
    margin: 0 auto;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-kontener {
    background: #F5F5F5 !important;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.KOZLOWSKISEBASTIAN .notatnik-wiersz {
    display: flex;
    gap: 10px;
    margin-top: 4px;
    margin-bottom: 4px;
}

.KOZLOWSKISEBASTIAN .notatnik-przycisk,
.KOZLOWSKISEBASTIAN .notatnik-input {
    background: #222222;
    color: #B0B0B0;
    border: none;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.15s;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-przycisk,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-input {
    background: #EEEEEE;
    color: #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-przycisk {
    flex: 1;
}

.KOZLOWSKISEBASTIAN .notatnik-input {
    flex: 2;
}

.KOZLOWSKISEBASTIAN .notatnik-przycisk:hover {
    color: #FF00FF;
    background: #333333;
    transform: translateY(-2px);
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-przycisk:hover {
    color: #333333;
    background: #E0E0E0;
}

.KOZLOWSKISEBASTIAN .notatnik-input:focus {
    box-shadow: 0 0 0 2px #FFF;
    outline: none;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-input:focus {
    box-shadow: 0 0 0 2px #333;
}

.KOZLOWSKISEBASTIAN .notatnik-lista {
    list-style-type: none;
    padding: 0;
    margin-top: 0px;
    margin-bottom: 0px;
    width: 100%;
    overflow-y: auto;
}

.KOZLOWSKISEBASTIAN .notatnik-element {
    padding: 8px;
    display: flex;
    flex-direction: column;
    background-color: #222;
    border-radius: 8px;
    margin-bottom: 4px;
    transition: all 0.15s;
    position: relative;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-element {
    background-color: #EEEEEE;
}

.KOZLOWSKISEBASTIAN .notatnik-element:hover {
    background-color: #333;
    transform: translateY(-2px);
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-element:hover {
    background-color: #E0E0E0;
}

.KOZLOWSKISEBASTIAN .notatnik-tekst {
    color: #B0B0B0;
    flex-grow: 1;
    word-break: break-word;
    padding-right: 60px;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-tekst {
    color: #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-element:hover .notatnik-tekst {
    color: #FF00FF;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-element:hover .notatnik-tekst {
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-akcje {
    display: flex;
    gap: 8px;
    position: absolute;
    right: 8px;
    top: 8px;
}

.KOZLOWSKISEBASTIAN .notatnik-usun,
.KOZLOWSKISEBASTIAN .notatnik-edytuj,
.KOZLOWSKISEBASTIAN .notatnik-zapisz,
.KOZLOWSKISEBASTIAN .notatnik-anuluj,
.KOZLOWSKISEBASTIAN .notatnik-tlumacz {
    color: #B0B0B0;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 14px;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-usun,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-edytuj,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-zapisz,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-anuluj,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-tlumacz {
    color: #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-usun:hover,
.KOZLOWSKISEBASTIAN .notatnik-edytuj:hover,
.KOZLOWSKISEBASTIAN .notatnik-zapisz:hover,
.KOZLOWSKISEBASTIAN .notatnik-anuluj:hover,
.KOZLOWSKISEBASTIAN .notatnik-tlumacz:hover {
    color: #FF00FF;
    transform: scale(1.2);
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-usun:hover,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-edytuj:hover,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-zapisz:hover,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-anuluj:hover,
.KOZLOWSKISEBASTIAN_JASNY .notatnik-tlumacz:hover {
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-tekst.editing {
    background-color: #333;
    padding: 8px;
    border-radius: 4px;
    cursor: text;
    outline: none;
    min-height: 20px;
    max-height: 200px;
    overflow-y: auto;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-tekst.editing {
    background-color: #E0E0E0;
}

.KOZLOWSKISEBASTIAN .notatnik-plik-input,
.KOZLOWSKISEBASTIAN .notatnik-import-input {
    display: none;
}

.KOZLOWSKISEBASTIAN .notatnik-element-image-container {
    position: relative;
    display: inline-block;
    margin-top: 4px;
    align-self: flex-start;
}

.KOZLOWSKISEBASTIAN .notatnik-element-image {
    max-width: 100%;
    max-height: 150px;
    border-radius: 4px;
    object-fit: contain;
    cursor: pointer;
}

.KOZLOWSKISEBASTIAN .notatnik-element-plik {
    color: #B0B0B0;
    text-decoration: underline;
    cursor: pointer;
    margin-top: 4px;
    word-break: break-all;
    display: flex;
    align-items: center;
    position: relative;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-element-plik {
    color: #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-element-plik i {
    color: #B0B0B0;
    margin-right: 8px;
    transition: color 0.15s;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-element-plik i {
    color: #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-element-plik:hover i {
    color: #FF00FF;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-element-plik:hover i {
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-usun-plik {
    position: absolute;
    top: -8px;
    left: -8px;
    background: #FF00FF;
    color: #B0B0B0;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.15s;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-usun-plik {
    background: #333333;
    color: #EEEEEE;
}

.KOZLOWSKISEBASTIAN .notatnik-element:hover .notatnik-usun-plik {
    opacity: 1;
}

.KOZLOWSKISEBASTIAN .notatnik-element.editing .notatnik-usun-plik {
    opacity: 1;
}

.KOZLOWSKISEBASTIAN .notatnik-nazwa-pliku {
    font-size: 12px;
    color: #B0B0B0;
    margin-top: 4px;
    margin-bottom: 4px;
    word-break: break-all;
    background-color: #222222;
    padding: 8px 8px;
    border-radius: 8px;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-nazwa-pliku {
    color: #555555;
    background-color: #EEEEEE;
}

.KOZLOWSKISEBASTIAN .notatnik-dialog {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #333;
    padding: 20px;
    border-radius: 8px;
    z-index: 1000;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    color: #B0B0B0;
    max-width: 90%;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-dialog {
    background: #F5F5F5;
    color: #555555;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

.KOZLOWSKISEBASTIAN .notatnik-dialog-przycisk {
    background: #222222;
    color: #B0B0B0;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 10px;
    transition: all 0.15s;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-dialog-przycisk {
    background: #EEEEEE;
    color: #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-dialog-przycisk:hover {
    color: #FF00FF;
    background: #333333;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-dialog-przycisk:hover {
    color: #333333;
    background: #E0E0E0;
}

.KOZLOWSKISEBASTIAN .notatnik-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 999;
}

.KOZLOWSKISEBASTIAN .notatnik-formatowanie {
    display: flex;
    gap: 5px;
    margin-bottom: 5px;
    flex-wrap: wrap;
    background: #444;
    padding: 8px;
    border-radius: 8px;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-formatowanie {
    background: #DDDDDD;
}

.KOZLOWSKISEBASTIAN .notatnik-formatowanie-przycisk {
    background: #555;
    color: #FFF;
    border: none;
    padding: 5px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.15s;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-formatowanie-przycisk {
    background: #CCCCCC;
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-formatowanie-przycisk-waskie {
    background: #555;
    color: #FFF;
    border: none;
    padding: 5px 5px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    min-width: 24px;
    transition: all 0.15s;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-formatowanie-przycisk-waskie {
    background: #CCCCCC;
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-formatowanie-przycisk:hover {
    background: #FF00FF;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-formatowanie-przycisk:hover {
    background: #333333;
    color: #FFFFFF;
}

.KOZLOWSKISEBASTIAN .notatnik-kolor-input {
    width: 30px;
    padding: 2px;
    background: #555;
    color: #FFF;
    border: none;
    border-radius: 4px;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-kolor-input {
    background: #CCCCCC;
}

.KOZLOWSKISEBASTIAN .notatnik-kolor-przycisk {
    background: #555;
    color: #FFF;
    border: none;
    padding: 5px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-kolor-przycisk {
    background: #CCCCCC;
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-etykieta {
    color: #FF00FF;
    font-size: 12px;
    margin-bottom: 4px;
    text-transform: uppercase;
    font-weight: bold;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-etykieta {
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-grupa-edycji {
    margin-bottom: 10px;
}

.KOZLOWSKISEBASTIAN .notatnik-zapisz {
    background: #222222;
    color: #B0B0B0;
    border: none;
    padding: 5px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    margin-left: auto;
    transition: all 0.15s;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-zapisz {
    background: #EEEEEE;
    color: #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-zapisz:hover {
    color: #FF00FF;
    background: #333333;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-zapisz:hover {
    color: #333333;
    background: #E0E0E0;
}

.KOZLOWSKISEBASTIAN .notatnik-ramka {
    border: 1px solid #B0B0B0;
    padding: 2px 5px;
    border-radius: 3px;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-ramka {
    border: 1px solid #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-ramka-tabela {
    border-collapse: collapse;
    margin: 5px 0;
    position: relative;
}

.KOZLOWSKISEBASTIAN .notatnik-ramka-tabela th {
    border: 1px solid #B0B0B0;
    padding: 5px;
    min-width: 20px;
    height: 20px;
    font-weight: normal;
    font-size: 12px;
    color: #FF00FF;
    text-align: center;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-ramka-tabela th {
    color: #333333;
    border: 1px solid #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-ramka-tabela td {
    border: 1px solid #B0B0B0;
    padding: 5px;
    min-width: 20px;
    height: 20px;
    position: relative;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-ramka-tabela td {
    border: 1px solid #555555;
}

.KOZLOWSKISEBASTIAN .notatnik-ramka-tabela td::before {
    content: attr(data-row);
    position: absolute;
    left: -20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 10px;
    color: #FF00FF;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-ramka-tabela td::before {
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-ramka-tabela-col-header {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    color: #FF00FF;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-ramka-tabela-col-header {
    color: #333333;
}

.KOZLOWSKISEBASTIAN .notatnik-link-dialog {
    display: none;
    position: absolute;
    background: #333;
    padding: 10px;
    border-radius: 5px;
    z-index: 1001;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-link-dialog {
    background: #F5F5F5;
    box-shadow: 0 0 5px rgba(0,0,0,0.2);
}

.KOZLOWSKISEBASTIAN .notatnik-link-input {
    background: #222;
    color: #B0B0B0;
    border: 1px solid #555;
    padding: 5px;
    border-radius: 3px;
    margin-bottom: 5px;
    width: 200px;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-link-input {
    background: #EEEEEE;
    color: #555555;
    border: 1px solid #CCCCCC;
}

.KOZLOWSKISEBASTIAN .notatnik-strike {
    text-decoration: line-through;
}

.KOZLOWSKISEBASTIAN .notatnik-tlumaczenie {
    font-size: 12px;
    color: #888;
    margin-top: 5px;
    padding: 5px;
    background: #222;
    border-radius: 5px;
    border-left: 3px solid #FF00FF;
}

.KOZLOWSKISEBASTIAN_JASNY .notatnik-tlumaczenie {
    color: #777777;
    background: #EEEEEE;
    border-left: 3px solid #333333;
}
/* NOTATNIK KONIEC */
    </style>
</head>
</head>
<body class="KOZLOWSKISEBASTIAN">
    <div class="KOZLOWSKISEBASTIAN_HEXAGON_KONTENER">
        <div class="KOZLOWSKISEBASTIAN_HEXAGON_KSZTALT"></div>
        <div class="KOZLOWSKISEBASTIAN_TROJKAT_KONTENER">
            <div class="KOZLOWSKISEBASTIAN_TROJKAT KOZLOWSKISEBASTIAN_TROJKAT_JEDEN"></div>
            <div class="KOZLOWSKISEBASTIAN_TROJKAT KOZLOWSKISEBASTIAN_TROJKAT_DWA"></div>
        </div>
    </div>
    <div class="notatnik-kontener">
	
        <div class="notatnik-wiersz">
            <button class="KOZLOWSKISEBASTIAN_PRZYBORNIK-PRZYCISK">PRZYBORNIK</button>
        </div>
        
        <!-- Grupa edycji nowej notatki -->
        <div class="notatnik-grupa-edycji" id="notatnik-grupa-nowa">
            <div class="notatnik-formatowanie" id="notatnik-formatowanie-nowa" style="display: none;">
                <button class="notatnik-formatowanie-przycisk" data-cmd="bold" title="POGRUBIENIE"><i class="fas fa-bold"></i></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="italic" title="KURSYWA"><i class="fas fa-italic"></i></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="underline" title="PODKREŚLENIE"><i class="fas fa-underline"></i></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="strikeThrough" title="PRZEKREŚLENIE"><i class="fas fa-strikethrough"></i></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="insertUnorderedList" title="LISTA WYPUNKTOWANA"><i class="fas fa-list-ul"></i></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="insertOrderedList" title="LISTA NUMEROWANA"><i class="fas fa-list-ol"></i></button>
                <button class="notatnik-formatowanie-przycisk" id="notatnik-wstaw-link" title="LINK"><i class="fas fa-link"></i></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="formatBlock" data-value="div" title="TABELA"><i class="fas fa-table"></i></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="hiliteColor" data-value="#333333" title="CIEMNE TŁO"><span style="background:#333333; padding:0 5px;">A</span></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="hiliteColor" data-value="#FF00FF" title="RÓŻOWE TŁO"><span style="background:#FF00FF; padding:0 5px;">A</span></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="hiliteColor" data-value="#ff4b4b" title="CZERWONE TŁO"><span style="background:#ff4b4b; padding:0 5px;">A</span></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="hiliteColor" data-value="#FFFFFF" title="BIAŁE TŁO"><span style="background:#FFFFFF; padding:0 5px; color:#000">A</span></button>
                <input type="color" class="notatnik-kolor-input" id="notatnik-kolor-input-nowa" value="#FF00FF">
                <button class="notatnik-formatowanie-przycisk-waskie" id="notatnik-kolor-zastosuj-nowa" title="ZASTOSUJ WŁASNE TŁO">✓</button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="foreColor" data-value="#FFFFFF" title="BIAŁY TEKST"><span style="color:#FFFFFF">A</span></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="foreColor" data-value="#FF00FF" title="RÓŻOWY TEKST"><span style="color:#FF00FF">A</span></button>
                <button class="notatnik-formatowanie-przycisk" data-cmd="foreColor" data-value="#ff4b4b" title="CZERWONY TEKST"><span style="color:#ff4b4b">A</span></button>
                <input type="color" class="notatnik-kolor-input" id="notatnik-kolor-tekst-input-nowa" value="#FF00FF">
                <button class="notatnik-formatowanie-przycisk-waskie" id="notatnik-kolor-tekst-zastosuj-nowa" title="ZASTOSUJ WŁASNY KOLOR TEKSTU">✓</button>
                <button class="notatnik-zapisz" id="notatnik-zapisz-nowa" title="ZAPISZ NOTATKĘ"><i class="fas fa-check"></i></button>
            </div>
            <div class="notatnik-wiersz">
                <div id="notatnik-edytor" class="notatnik-input" contenteditable="true" placeholder="WPISZ TREŚĆ NOTATKI..."></div>
            </div>
        </div>
        
        <div class="notatnik-wiersz">
            <button class="notatnik-przycisk" id="notatnik-dodaj-plik">ZAŁĄCZ PLIK</button>
            <input type="file" class="notatnik-plik-input" id="notatnik-plik-input">
            <button class="notatnik-przycisk" id="notatnik-dodaj">DODAJ NOTATKĘ</button>
        </div>
        
        <div class="notatnik-wiersz">
            <button class="notatnik-przycisk" id="notatnik-eksportuj">EKSPORTUJ ZIP</button>
            <button class="notatnik-przycisk" id="notatnik-importuj">IMPORTUJ ZIP</button>
            <input type="file" accept=".zip" class="notatnik-import-input" id="notatnik-import-input">
        </div>
        
        <div id="notatnik-nazwa-pliku" class="notatnik-nazwa-pliku">&nbsp;</div>
        
        <ul class="notatnik-lista" id="notatnik-lista"></ul>
    </div>

    <div class="notatnik-overlay" id="notatnik-overlay"></div>
    <div class="notatnik-dialog" id="notatnik-dialog">
        <p id="notatnik-dialog-tekst"></p>
        <button class="notatnik-dialog-przycisk" id="notatnik-dialog-przycisk">OK</button>
    </div>
    
    <!-- Dialog do tworzenia tabeli -->
    <div class="notatnik-dialog" id="notatnik-dialog-tabela" style="display: none;">
        <p>UTWÓRZ TABELĘ</p>
        <div>
            <label for="notatnik-tabela-wiersze">LICZBA WIERSZY:</label>
            <input type="number" id="notatnik-tabela-wiersze" class="notatnik-dialog-input" min="1" max="10" value="2">
        </div>
        <div>
            <label for="notatnik-tabela-kolumny">LICZBA KOLUMN:</label>
            <input type="number" id="notatnik-tabela-kolumny" class="notatnik-dialog-input" min="1" max="10" value="2">
        </div>
        <button class="notatnik-dialog-przycisk" id="notatnik-dialog-tabela-ok">UTWÓRZ</button>
        <button class="notatnik-dialog-przycisk" id="notatnik-dialog-tabela-anuluj">ANULUJ</button>
    </div>

    <!-- Dialog do wstawiania linków -->
    <div class="notatnik-link-dialog" id="notatnik-link-dialog">
        <input type="text" id="notatnik-link-url" class="notatnik-link-input" placeholder="Wpisz URL">
        <button class="notatnik-dialog-przycisk" id="notatnik-link-zatwierdz">OK</button>
        <button class="notatnik-dialog-przycisk" id="notatnik-link-anuluj">ANULUJ</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // INICJALIZACJA INDEXEDDB
        let db;
        const request = indexedDB.open('NotatnikDB', 15);

        request.onerror = function(event) {
            console.error("BŁĄD PRZY OTWIERANIU BAZY DANYCH:", event.target.error);
        };

        request.onsuccess = function(event) {
            db = event.target.result;
            wyswietlNotatki();
        };

        request.onupgradeneeded = function(event) {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('notatki')) {
                const objectStore = db.createObjectStore('notatki', { keyPath: 'id', autoIncrement: true });
                objectStore.createIndex('text', 'text', { unique: false });
                objectStore.createIndex('file', 'file', { unique: false });
                objectStore.createIndex('filename', 'filename', { unique: false });
                objectStore.createIndex('filetype', 'filetype', { unique: false });
                objectStore.createIndex('createdAt', 'createdAt', { unique: false });
            }
        };

        // ELEMENTY DOM
        const listaNotatek = document.getElementById('notatnik-lista');
        const dodajNotatkeBtn = document.getElementById('notatnik-dodaj');
        const dodajPlikBtn = document.getElementById('notatnik-dodaj-plik');
        const eksportujBtn = document.getElementById('notatnik-eksportuj');
        const importujBtn = document.getElementById('notatnik-importuj');
        const inputPlik = document.getElementById('notatnik-plik-input');
        const inputImport = document.getElementById('notatnik-import-input');
        const edytorNotatki = document.getElementById('notatnik-edytor');
        const nazwaPlikuElement = document.getElementById('notatnik-nazwa-pliku');
        const overlay = document.getElementById('notatnik-overlay');
        const dialog = document.getElementById('notatnik-dialog');
        const dialogTekst = document.getElementById('notatnik-dialog-tekst');
        const dialogPrzycisk = document.getElementById('notatnik-dialog-przycisk');
        const formatowaniePanelNowa = document.getElementById('notatnik-formatowanie-nowa');
        const kolorInputNowa = document.getElementById('notatnik-kolor-input-nowa');
        const kolorZastosujBtnNowa = document.getElementById('notatnik-kolor-zastosuj-nowa');
        const kolorTekstInputNowa = document.getElementById('notatnik-kolor-tekst-input-nowa');
        const kolorTekstZastosujBtnNowa = document.getElementById('notatnik-kolor-tekst-zastosuj-nowa');
        const zapiszBtnNowa = document.getElementById('notatnik-zapisz-nowa');
        const dialogTabela = document.getElementById('notatnik-dialog-tabela');
        const tabelaWierszeInput = document.getElementById('notatnik-tabela-wiersze');
        const tabelaKolumnyInput = document.getElementById('notatnik-tabela-kolumny');
        const tabelaOkBtn = document.getElementById('notatnik-dialog-tabela-ok');
        const tabelaAnulujBtn = document.getElementById('notatnik-dialog-tabela-anuluj');
        const linkDialog = document.getElementById('notatnik-link-dialog');
        const linkUrlInput = document.getElementById('notatnik-link-url');
        const linkZatwierdzBtn = document.getElementById('notatnik-link-zatwierdz');
        const linkAnulujBtn = document.getElementById('notatnik-link-anuluj');
        const wstawLinkBtn = document.getElementById('notatnik-wstaw-link');

        let aktualnyPlik = null;
        let aktualnaNazwaPliku = '';
        let aktualnyTypPliku = '';
        let aktualnieEdytoanyElement = null;
        let aktualnyPanelFormatowania = null;
        let oryginalnaTrescNotatki = '';
        let wybranyTekstDoLinku = '';

        // FUNKCJE POMOCNICZE
        function pokazDialog(tekst) {
            dialogTekst.innerHTML = tekst;
            dialog.style.display = 'block';
            overlay.style.display = 'block';
        }

        function zamknijDialog() {
            dialog.style.display = 'none';
            overlay.style.display = 'none';
        }

        function pokazDialogTabela() {
            dialogTabela.style.display = 'block';
            overlay.style.display = 'block';
        }

        function zamknijDialogTabela() {
            dialogTabela.style.display = 'none';
            overlay.style.display = 'none';
        }

        function pokazLinkDialog() {
            const selection = window.getSelection();
            wybranyTekstDoLinku = selection.toString();
            
            if (aktualnieEdytoanyElement) {
                const rect = aktualnieEdytoanyElement.getBoundingClientRect();
                linkDialog.style.top = `${rect.bottom + window.scrollY}px`;
                linkDialog.style.left = `${rect.left + window.scrollX}px`;
            } else {
                const rect = edytorNotatki.getBoundingClientRect();
                linkDialog.style.top = `${rect.bottom + window.scrollY}px`;
                linkDialog.style.left = `${rect.left + window.scrollX}px`;
            }
            
            linkDialog.style.display = 'block';
            linkUrlInput.focus();
        }

        function zamknijLinkDialog() {
            linkDialog.style.display = 'none';
            linkUrlInput.value = '';
        }

        function wstawLink(url) {
            if (!url) return;
            
            // Jeśli nie ma wybranego tekstu, użyj URL jako tekstu linku
            const tekstLinku = wybranyTekstDoLinku || url;
            
            if (aktualnieEdytoanyElement) {
                document.execCommand('insertHTML', false, `<a href="${url}" target="_blank">${tekstLinku}</a>`);
                aktualnieEdytoanyElement.focus();
            } else {
                document.execCommand('insertHTML', false, `<a href="${url}" target="_blank">${tekstLinku}</a>`);
                edytorNotatki.focus();
            }
        }

        function dataURLtoBlob(dataURL) {
            const arr = dataURL.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], {type: mime});
        }

        function formatujDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('pl-PL', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        async function tlumaczTekst(tekst, jezykDocelowy = 'en') {
            try {
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(tekst)}&langpair=pl|${jezykDocelowy}`);
                const data = await response.json();
                
                if (data.responseData && data.responseData.translatedText) {
                    return data.responseData.translatedText;
                } else {
                    throw new Error("Nie udało się przetłumaczyć tekstu");
                }
            } catch (error) {
                console.error("Błąd tłumaczenia:", error);
                return "Błąd tłumaczenia: " + error.message;
            }
        }

        function wykonajPolecenieFormatowania(cmd, value = null) {
            document.execCommand(cmd, false, value);
            if (aktualnieEdytoanyElement) {
                aktualnieEdytoanyElement.focus();
            } else {
                edytorNotatki.focus();
            }
        }

        function dostosujWysokoscTextarea(element) {
            element.style.height = 'auto';
            element.style.height = (element.scrollHeight) + 'px';
        }

        function zapiszNotatke(element) {
            if (!element) return;
            
            const li = element.closest('.notatnik-element');
            const id = li.getAttribute('data-id');
            
            const transaction = db.transaction(['notatki'], 'readwrite');
            const objectStore = transaction.objectStore('notatki');
            const getRequest = objectStore.get(parseInt(id));
            
            getRequest.onsuccess = function() {
                const data = getRequest.result;
                data.text = element.innerHTML || '';
                objectStore.put(data);
                
                // Ukryj panel formatowania
                if (aktualnyPanelFormatowania) {
                    aktualnyPanelFormatowania.remove();
                    aktualnyPanelFormatowania = null;
                }
                
                // Zakończ edycję
                element.contentEditable = false;
                element.classList.remove('editing');
                li.classList.remove('editing');
                aktualnieEdytoanyElement = null;
                
                // Przywróć przyciski
                const edytuj = li.querySelector('.notatnik-edytuj');
                const usun = li.querySelector('.notatnik-usun');
                const zapisz = li.querySelector('.notatnik-zapisz');
                const anuluj = li.querySelector('.notatnik-anuluj');
                const tlumacz = li.querySelector('.notatnik-tlumacz');
                
                if (edytuj) edytuj.style.display = 'inline-block';
                if (usun) usun.style.display = 'inline-block';
                if (zapisz) zapisz.style.display = 'none';
                if (anuluj) anuluj.style.display = 'none';
                if (tlumacz) tlumacz.style.display = 'inline-block';
                
                wyswietlNotatki();
            };
        }

        function anulujEdycje(element) {
            if (!element) return;
            
            const li = element.closest('.notatnik-element');
            
            // Przywróć oryginalną treść
            element.innerHTML = oryginalnaTrescNotatki;
            
            // Ukryj panel formatowania
            if (aktualnyPanelFormatowania) {
                aktualnyPanelFormatowania.remove();
                aktualnyPanelFormatowania = null;
            }
            
            // Zakończ edycję
            element.contentEditable = false;
            element.classList.remove('editing');
            li.classList.remove('editing');
            aktualnieEdytoanyElement = null;
            
            // Przywróć przyciski
            const edytuj = li.querySelector('.notatnik-edytuj');
            const usun = li.querySelector('.notatnik-usun');
            const zapisz = li.querySelector('.notatnik-zapisz');
            const anuluj = li.querySelector('.notatnik-anuluj');
            const tlumacz = li.querySelector('.notatnik-tlumacz');
            
            if (edytuj) edytuj.style.display = 'inline-block';
            if (usun) usun.style.display = 'inline-block';
            if (zapisz) zapisz.style.display = 'none';
            if (anuluj) anuluj.style.display = 'none';
            if (tlumacz) tlumacz.style.display = 'inline-block';
            
            wyswietlNotatki();
        }

        function utworzTabele(wiersze, kolumny) {
            let html = '<table class="notatnik-ramka-tabela" border="1"><thead><tr><th></th>';
            
            // Nagłówki kolumn (A, B, C...)
            for (let j = 0; j < kolumny; j++) {
                const colLetter = String.fromCharCode(65 + j); // A, B, C, ...
                html += `<th>${colLetter}</th>`;
            }
            html += '</tr></thead><tbody>';
            
            // Wiersze z numeracją
            for (let i = 0; i < wiersze; i++) {
                html += `<tr><td style="color:#FF00FF; text-align:center; font-size:12px;">${i+1}</td>`;
                for (let j = 0; j < kolumny; j++) {
                    html += '<td>&nbsp;</td>';
                }
                html += '</tr>';
            }
            html += '</tbody></table>';
            
            if (aktualnieEdytoanyElement) {
                const range = window.getSelection().getRangeAt(0);
                range.deleteContents();
                range.insertNode(document.createRange().createContextualFragment(html));
                aktualnieEdytoanyElement.focus();
            } else {
                const range = document.createRange();
                range.selectNodeContents(edytorNotatki);
                range.deleteContents();
                range.insertNode(document.createRange().createContextualFragment(html));
                edytorNotatki.focus();
            }
        }

        // OBSŁUGA DIALOGU
        dialogPrzycisk.addEventListener('click', zamknijDialog);
        overlay.addEventListener('click', zamknijDialog);

        // OBSŁUGA DIALOGU TABELI
        tabelaOkBtn.addEventListener('click', () => {
            const wiersze = parseInt(tabelaWierszeInput.value) || 2;
            const kolumny = parseInt(tabelaKolumnyInput.value) || 2;
            utworzTabele(wiersze, kolumny);
            zamknijDialogTabela();
        });

        tabelaAnulujBtn.addEventListener('click', zamknijDialogTabela);

        // OBSŁUGA DIALOGU LINKÓW
        wstawLinkBtn.addEventListener('click', pokazLinkDialog);
        linkZatwierdzBtn.addEventListener('click', () => {
            const url = linkUrlInput.value.trim();
            if (url) {
                wstawLink(url);
            }
            zamknijLinkDialog();
        });
        linkAnulujBtn.addEventListener('click', zamknijLinkDialog);

        // OBSŁUGA FORMATOWANIA TEKSTU (NOWA NOTATKA)
        document.querySelectorAll('#notatnik-formatowanie-nowa .notatnik-formatowanie-przycisk').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const cmd = btn.getAttribute('data-cmd');
                const value = btn.getAttribute('data-value');
                
                if (cmd === 'formatBlock' && value === 'div') {
                    pokazDialogTabela();
                } else {
                    wykonajPolecenieFormatowania(cmd, value);
                }
                
                edytorNotatki.focus();
                return false;
            });
        });

        kolorZastosujBtnNowa.addEventListener('click', (e) => {
            e.preventDefault();
            wykonajPolecenieFormatowania('hiliteColor', kolorInputNowa.value);
            edytorNotatki.focus();
            return false;
        });

        kolorTekstZastosujBtnNowa.addEventListener('click', (e) => {
            e.preventDefault();
            wykonajPolecenieFormatowania('foreColor', kolorTekstInputNowa.value);
            edytorNotatki.focus();
            return false;
        });

        // OBSŁUGA ZAPISU NOWEJ NOTATKI
        zapiszBtnNowa.addEventListener('click', (e) => {
            e.preventDefault();
            dodajNotatke();
            return false;
        });

        // POKAŻ PANEL FORMATOWANIA PODCZAS EDYCJI NOWEJ NOTATKI
        edytorNotatki.addEventListener('focus', function() {
            formatowaniePanelNowa.style.display = 'flex';
        });

        edytorNotatki.addEventListener('blur', function() {
            // Opóźnione ukrycie, aby można było kliknąć przyciski formatowania
            setTimeout(() => {
                if (!formatowaniePanelNowa.contains(document.activeElement)) {
                    formatowaniePanelNowa.style.display = 'none';
                }
            }, 200);
        });

        // FUNKCJA DO RENDEROWANIA LISTY
        function wyswietlNotatki() {
            const transaction = db.transaction(['notatki'], 'readonly');
            const objectStore = transaction.objectStore('notatki');
            const request = objectStore.getAll();

            request.onsuccess = function(event) {
                const notatki = event.target.result;
                listaNotatek.innerHTML = '';
                
                notatki.forEach((item) => {
                    const li = document.createElement('li');
                    li.className = 'notatnik-element';
                    li.setAttribute('data-id', item.id);
                    
                    let fileHtml = '';
                    if (item.file) {
                        if (item.filetype && item.filetype.startsWith('image/')) {
                            fileHtml = `
                                <div class="notatnik-element-image-container">
                                    <span class="notatnik-usun-plik" title="USUŃ PLIK">X</span>
                                    <img src="${item.file}" class="notatnik-element-image" data-file="${item.filename}">
                                </div>
                            `;
                        } else {
                            let iconClass = 'fa-file';
                            if (/pdf/.test(item.filetype)) iconClass = 'fa-file-pdf';
                            else if (/word|document/.test(item.filetype)) iconClass = 'fa-file-word';
                            else if (/text|plain/.test(item.filetype)) iconClass = 'fa-file-alt';
                            else if (/html/.test(item.filetype)) iconClass = 'fa-file-code';
                            else if (/zip|rar|7z/.test(item.filetype)) iconClass = 'fa-file-archive';
                            else if (/excel|spreadsheet/.test(item.filetype)) iconClass = 'fa-file-excel';
                            else if (/powerpoint|presentation/.test(item.filetype)) iconClass = 'fa-file-powerpoint';

                            fileHtml = `
                                <div class="notatnik-element-plik" data-file="${item.filename}">
                                    <span class="notatnik-usun-plik" title="USUŃ PLIK">X</span>
                                    <i class="fas ${iconClass}"></i>
                                    ${item.filename}
                                </div>
                            `;
                        }
                    }
                    
                    li.innerHTML = `
                        <span class="notatnik-tekst">${item.text || '&nbsp;'}</span>
                        ${fileHtml}
                        <div class="notatnik-akcje">
                            <span class="notatnik-edytuj"><i class="fas fa-edit"></i></span>
                            <span class="notatnik-zapisz" style="display:none;"><i class="fas fa-check"></i></span>
                            <span class="notatnik-anuluj" style="display:none;"><i class="fas fa-times"></i></span>
                            <span class="notatnik-tlumacz"><i class="fas fa-language"></i></span>
                            <span class="notatnik-usun"><i class="fas fa-trash-alt"></i></span>
                        </div>
                    `;
                    listaNotatek.appendChild(li);

                    // ELEMENTY W LIŚCIE
                    const tekst = li.querySelector('.notatnik-tekst');
                    const edytuj = li.querySelector('.notatnik-edytuj');
                    const zapisz = li.querySelector('.notatnik-zapisz');
                    const anuluj = li.querySelector('.notatnik-anuluj');
                    const tlumacz = li.querySelector('.notatnik-tlumacz');
                    const usun = li.querySelector('.notatnik-usun');
                    const usunPlik = li.querySelector('.notatnik-usun-plik');
                    const plikElement = li.querySelector('.notatnik-element-image, .notatnik-element-plik');
                    
                    // OBSŁUGA EDYCJI
                    edytuj.addEventListener('click', () => {
                        if (aktualnyPanelFormatowania) {
                            aktualnyPanelFormatowania.remove();
                        }
                        
                        // Utwórz dynamiczny panel formatowania dla tej notatki
                        const formatowaniePanel = document.createElement('div');
                        formatowaniePanel.className = 'notatnik-formatowanie';
                        formatowaniePanel.innerHTML = `
                            <button class="notatnik-formatowanie-przycisk" data-cmd="bold" title="POGRUBIENIE"><i class="fas fa-bold"></i></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="italic" title="KURSYWA"><i class="fas fa-italic"></i></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="underline" title="PODKREŚLENIE"><i class="fas fa-underline"></i></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="strikeThrough" title="PRZEKREŚLENIE"><i class="fas fa-strikethrough"></i></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="insertUnorderedList" title="LISTA WYPUNKTOWANA"><i class="fas fa-list-ul"></i></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="insertOrderedList" title="LISTA NUMEROWANA"><i class="fas fa-list-ol"></i></button>
                            <button class="notatnik-formatowanie-przycisk" id="notatnik-wstaw-link-edytor" title="LINK"><i class="fas fa-link"></i></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="formatBlock" data-value="div" title="TABELA"><i class="fas fa-table"></i></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="hiliteColor" data-value="#333333" title="CIEMNE TŁO"><span style="background:#333333; padding:0 5px;">A</span></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="hiliteColor" data-value="#FF00FF" title="RÓŻOWE TŁO"><span style="background:#FF00FF; padding:0 5px;">A</span></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="hiliteColor" data-value="#ff4b4b" title="CZERWONE TŁO"><span style="background:#ff4b4b; padding:0 5px;">A</span></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="hiliteColor" data-value="#FFFFFF" title="BIAŁE TŁO"><span style="background:#FFFFFF; padding:0 5px; color:#000">A</span></button>
                            <input type="color" class="notatnik-kolor-input" value="#FF00FF">
                            <button class="notatnik-formatowanie-przycisk-waskie" title="ZASTOSUJ WŁASNE TŁO">✓</button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="foreColor" data-value="#FFFFFF" title="BIAŁY TEKST"><span style="color:#FFFFFF">A</span></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="foreColor" data-value="#FF00FF" title="RÓŻOWY TEKST"><span style="color:#FF00FF">A</span></button>
                            <button class="notatnik-formatowanie-przycisk" data-cmd="foreColor" data-value="#ff4b4b" title="CZERWONY TEKST"><span style="color:#ff4b4b">A</span></button>
                            <input type="color" class="notatnik-kolor-input" value="#FF00FF">
                            <button class="notatnik-formatowanie-przycisk-waskie" title="ZASTOSUJ WŁASNY KOLOR TEKSTU">✓</button>
                        `;
                        
                        // Wstaw panel formatowania przed edytowanym elementem
                        li.parentNode.insertBefore(formatowaniePanel, li);
                        aktualnyPanelFormatowania = formatowaniePanel;
                        
                        // Zapisz oryginalną treść notatki
                        oryginalnaTrescNotatki = tekst.innerHTML;
                        
                        tekst.contentEditable = true;
                        tekst.classList.add('editing');
                        li.classList.add('editing');
                        aktualnieEdytoanyElement = tekst;
                        
                        // Pokaż przyciski zapisz/anuluj, ukryj edytuj/usun/tlumacz
                        edytuj.style.display = 'none';
                        usun.style.display = 'none';
                        tlumacz.style.display = 'none';
                        zapisz.style.display = 'inline-block';
                        anuluj.style.display = 'inline-block';
                        
                        tekst.focus();
                        
                        const range = document.createRange();
                        range.selectNodeContents(tekst);
                        const selection = window.getSelection();
                        selection.removeAllRanges();
                        selection.addRange(range);
                        
                        // Obsługa przycisków formatowania
                        formatowaniePanel.querySelectorAll('.notatnik-formatowanie-przycisk').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                e.preventDefault();
                                const cmd = btn.getAttribute('data-cmd');
                                const value = btn.getAttribute('data-value');
                                
                                if (cmd === 'formatBlock' && value === 'div') {
                                    pokazDialogTabela();
                                } else {
                                    wykonajPolecenieFormatowania(cmd, value);
                                }
                                
                                tekst.focus();
                                return false;
                            });
                        });
                        
                        // Obsługa przycisku wstawiania linku w edytorze
                        const wstawLinkBtnEdytor = formatowaniePanel.querySelector('#notatnik-wstaw-link-edytor');
                        wstawLinkBtnEdytor.addEventListener('click', (e) => {
                            e.preventDefault();
                            pokazLinkDialog();
                            return false;
                        });
                        
                        // Obsługa własnego koloru tła
                        const kolorInput = formatowaniePanel.querySelectorAll('.notatnik-kolor-input')[0];
                        const kolorZastosujBtn = formatowaniePanel.querySelectorAll('.notatnik-formatowanie-przycisk-waskie')[0];
                        
                        kolorZastosujBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            wykonajPolecenieFormatowania('hiliteColor', kolorInput.value);
                            tekst.focus();
                            return false;
                        });
                        
                        // Obsługa własnego koloru tekstu
                        const kolorTekstInput = formatowaniePanel.querySelectorAll('.notatnik-kolor-input')[1];
                        const kolorTekstZastosujBtn = formatowaniePanel.querySelectorAll('.notatnik-formatowanie-przycisk-waskie')[1];
                        
                        kolorTekstZastosujBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            wykonajPolecenieFormatowania('foreColor', kolorTekstInput.value);
                            tekst.focus();
                            return false;
                        });
                    });
                    
                    // OBSŁUGA ZAPISU ZMIAN
                    zapisz.addEventListener('click', (e) => {
                        e.stopPropagation();
                        zapiszNotatke(tekst);
                    });
                    
                    // OBSŁUGA ANULOWANIA EDYCJI
                    anuluj.addEventListener('click', (e) => {
                        e.stopPropagation();
                        anulujEdycje(tekst);
                    });
                    
                    // OBSŁUGA TŁUMACZENIA
                    tlumacz.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        
                        const tekstDoTlumaczenia = tekst.textContent.trim();
                        if (!tekstDoTlumaczenia) return;
                        
                        const tlumaczenieElement = li.querySelector('.notatnik-tlumaczenie');
                        if (tlumaczenieElement) {
                            tlumaczenieElement.remove();
                            return;
                        }
                        
                        try {
                            const przetlumaczonyTekst = await tlumaczTekst(tekstDoTlumaczenia);
                            const tlumaczenieDiv = document.createElement('div');
                            tlumaczenieDiv.className = 'notatnik-tlumaczenie';
                            tlumaczenieDiv.textContent = przetlumaczonyTekst;
                            li.appendChild(tlumaczenieDiv);
                        } catch (error) {
                            console.error("Błąd tłumaczenia:", error);
                        }
                    });
                    
                    // OBSŁUGA KLIKNIĘCIA W PLIK (POBIERANIE OD RAZU)
                    if (plikElement) {
                        plikElement.addEventListener('click', (e) => {
                            if (e.target.classList.contains('notatnik-usun-plik') || 
                                e.target.classList.contains('fa')) return;
                            
                            const transaction = db.transaction(['notatki'], 'readonly');
                            const objectStore = transaction.objectStore('notatki');
                            const getRequest = objectStore.get(item.id);
                            
                            getRequest.onsuccess = function() {
                                const data = getRequest.result;
                                if (data.file) {
                                    const link = document.createElement('a');
                                    link.href = data.file;
                                    link.download = data.filename;
                                    document.body.appendChild(link);
                                    link.click();
                                    document.body.removeChild(link);
                                }
                            };
                        });
                    }
                    
                    // OBSŁUGA USUWANIA PLIKU
                    if (usunPlik) {
                        usunPlik.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const transaction = db.transaction(['notatki'], 'readwrite');
                            const objectStore = transaction.objectStore('notatki');
                            const getRequest = objectStore.get(item.id);
                            
                            getRequest.onsuccess = function() {
                                const data = getRequest.result;
                                data.file = null;
                                data.filename = '';
                                data.filetype = '';
                                objectStore.put(data);
                                wyswietlNotatki();
                            };
                        });
                    }
                    
                    // OBSŁUGA USUWANIA CAŁEGO ELEMENTU
                    usun.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const transaction = db.transaction(['notatki'], 'readwrite');
                        const objectStore = transaction.objectStore('notatki');
                        objectStore.delete(item.id);
                        
                        li.style.transform = 'translateX(100%)';
                        li.style.opacity = '0';
                        setTimeout(() => {
                            wyswietlNotatki();
                        }, 300);
                    });
                });
            };
        }

        // OBSŁUGA DODAWANIA NOWYCH PLIKÓW
        dodajPlikBtn.addEventListener('click', () => {
            inputPlik.click();
        });
        
        inputPlik.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                aktualnaNazwaPliku = file.name;
                aktualnyTypPliku = file.type;
                nazwaPlikuElement.textContent = `WYBRANY PLIK: ${aktualnaNazwaPliku}`;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    aktualnyPlik = event.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                aktualnaNazwaPliku = '';
                aktualnyTypPliku = '';
                nazwaPlikuElement.innerHTML = '&nbsp;';
            }
        });

        // OBSŁUGA DODAWANIA NOWYCH NOTATEK
        function dodajNotatke() {
            const tekst = edytorNotatki.innerHTML.trim();
            if (tekst || aktualnyPlik) {
                const transaction = db.transaction(['notatki'], 'readwrite');
                const objectStore = transaction.objectStore('notatki');
                
                const nowaNotatka = {
                    text: tekst || '',
                    file: aktualnyPlik || null,
                    filename: aktualnaNazwaPliku || '',
                    filetype: aktualnyTypPliku || '',
                    createdAt: new Date().getTime()
                };
                
                const request = objectStore.add(nowaNotatka);
                
                request.onsuccess = function() {
                    edytorNotatki.innerHTML = '';
                    aktualnyPlik = null;
                    aktualnaNazwaPliku = '';
                    aktualnyTypPliku = '';
                    inputPlik.value = '';
                    nazwaPlikuElement.innerHTML = '&nbsp;';
                    wyswietlNotatki();
                };
            }
        }

        dodajNotatkeBtn.addEventListener('click', dodajNotatke);

        edytorNotatki.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.execCommand('insertLineBreak');
            }
        });

        // DYNAMICZNE DOSTOSOWYWANIE WYSOKOŚCI POLA INPUT
        edytorNotatki.addEventListener('input', function() {
            dostosujWysokoscTextarea(this);
        });

        // EKSPORT NOTATEK DO ZIP
        eksportujBtn.addEventListener('click', async () => {
            try {
                const notatki = await new Promise((resolve) => {
                    const trans = db.transaction(['notatki'], 'readonly');
                    trans.objectStore('notatki').getAll().onsuccess = (e) => resolve(e.target.result);
                });

                const zip = new JSZip();
                const notesFolder = zip.folder("notatki");
                const filesFolder = zip.folder("pliki");
                
                let txtContent = "PRZYBORNIK NOTATNIK - EKSPORT\n";
                txtContent += `DATA EKSPORTU: ${formatujDate(new Date().getTime())}\n\n`;
                txtContent += "================================\n\n";
                
                notatki.forEach((note, index) => {
                    txtContent += `NOTATKA ${index + 1}\n`;
                    txtContent += `DATA UTWORZENIA: ${formatujDate(note.createdAt || new Date().getTime())}\n`;
                    txtContent += `TREŚĆ: ${note.text || '(BRAK TEKSTU)'}\n`;
                    
                    if (note.filename) {
                        txtContent += `ZAŁĄCZNIK: ${note.filename}\n`;
                        txtContent += `TYP PLIKU: ${note.filetype || 'NIEZNANY'}\n`;
                    }
                    
                    txtContent += "\n================================\n\n";
                });
                
                notesFolder.file("PRZYBORNIK_NOTATNIK.txt", txtContent);
                
                let fileCount = 0;
                for (const note of notatki) {
                    if (note.file) {
                        const blob = dataURLtoBlob(note.file);
                        filesFolder.file(note.filename, blob);
                        fileCount++;
                    }
                }
                
                const currentDate = new Date();
                const formattedDate = [
                    currentDate.getFullYear(),
                    (currentDate.getMonth() + 1).toString().padStart(2, '0'),
                    currentDate.getDate().toString().padStart(2, '0')
                ].join('-');
                
                const content = await zip.generateAsync({type: "blob"});
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = `PRZYBORNIK_NOTATNIK_${formattedDate}.zip`;
                a.click();
                URL.revokeObjectURL(url);
                
                pokazDialog(`WYEKSPORTOWANO ${notatki.length} NOTATEK I ${fileCount} PLIKÓW DO ZIP!`);
            } catch (error) {
                pokazDialog("BŁĄD PODCZAS EKSPORTU: " + error.message);
            }
        });

        // IMPORT NOTATEK Z ZIP
        importujBtn.addEventListener('click', () => {
            inputImport.click();
        });

        inputImport.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const zip = new JSZip();
                const content = await zip.loadAsync(file);
                
                // SPRAWDŹ CZY TO NASZ FORMAT PLIKU
                const notesFile = content.files["notatki/PRZYBORNIK_NOTATNIK.txt"];
                if (!notesFile) {
                    throw new Error("NIEPRAWIDŁOWY FORMAT PLIKU ZIP - BRAK PLIKU PRZYBORNIK_NOTATNIK.TXT");
                }
                
                // WCZYTAJ PLIKI
                const pliki = {};
                for (const [path, file] of Object.entries(content.files)) {
                    if (path.startsWith("pliki/") && !file.dir) {
                        const filename = path.replace("pliki/", "");
                        const fileData = await file.async("base64");
                        pliki[filename] = `data:application/octet-stream;base64,${fileData}`;
                    }
                }
                
                // WCZYTAJ NOTATKI Z PLIKU TEKSTOWEGO
                const notesText = await notesFile.async("text");
                const noteLines = notesText.split('\n');
                const notesData = [];
                let currentNote = {};
                
                for (const line of noteLines) {
                    if (line.startsWith('NOTATKA ')) {
                        if (Object.keys(currentNote).length > 0) {
                            notesData.push(currentNote);
                            currentNote = {};
                        }
                    } else if (line.startsWith('DATA UTWORZENIA: ')) {
                        const dateStr = line.replace('DATA UTWORZENIA: ', '');
                        // TUTAJ MOŻNA DODAĆ PARSOWANIE DATY JEŚLI POTRZEBNE
                    } else if (line.startsWith('TREŚĆ: ')) {
                        currentNote.text = line.replace('TREŚĆ: ', '');
                    } else if (line.startsWith('ZAŁĄCZNIK: ')) {
                        const filename = line.replace('ZAŁĄCZNIK: ', '');
                        if (pliki[filename]) {
                            currentNote.file = pliki[filename];
                            currentNote.filename = filename;
                        }
                    } else if (line.startsWith('TYP PLIKU: ')) {
                        currentNote.filetype = line.replace('TYP PLIKU: ', '');
                    }
                }
                
                if (Object.keys(currentNote).length > 0) {
                    notesData.push(currentNote);
                }
                
                // ZAPISZ DO BAZY DANYCH
                const clearTransaction = db.transaction(['notatki'], 'readwrite');
                const clearRequest = clearTransaction.objectStore('notatki').clear();
                
                clearRequest.onsuccess = () => {
                    const addTransaction = db.transaction(['notatki'], 'readwrite');
                    const objectStore = addTransaction.objectStore('notatki');
                    
                    let addedNotes = 0;
                    let addedFiles = 0;
                    
                    for (const note of notesData) {
                        const nowaNotatka = {
                            text: note.text || '',
                            file: note.file || null,
                            filename: note.filename || '',
                            filetype: note.filetype || '',
                            createdAt: new Date().getTime()
                        };
                        
                        if (note.file) addedFiles++;
                        objectStore.add(nowaNotatka);
                        addedNotes++;
                    }
                    
                    addTransaction.oncomplete = () => {
                        wyswietlNotatki();
                        pokazDialog(`ZAIMPORTOWANO ${addedNotes} NOTATEK (W TYM ${addedFiles} Z ZAŁĄCZNIKAMI) Z ARCHIWUM ZIP!`);
                        inputImport.value = '';
                    };
                };
            } catch (error) {
                pokazDialog("BŁĄD IMPORTU: " + error.message);
                inputImport.value = '';
            }
        });

        // INICJALIZACJA - WYŚWIETL NOTATKI PO ZAŁADOWANIU STRONY
        window.addEventListener('load', wyswietlNotatki);
    </script>
	<script src="https://kozlowskisebastian.pl/JS/PRZYBORNIK.js"></script>
</body>
</html>
